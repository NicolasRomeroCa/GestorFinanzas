<div class="container">
    <h1 class="page-title">Estas son tus Metas</h1>

    <div class="metas-container">
        <% metas.forEach(meta=> { %>
            <div class="meta-row">
                <div class="meta-icon">
                    <%= meta.icono %>
                </div>
                <div class="meta-description">
                    <%= meta.descripcion %>
                </div>
                <div class="meta-amount">
                    <%= meta.monto %>
                </div>
                <div class="meta-actions">
                    <button class="meta-btn-delete">üóëÔ∏è</button>
                    <button class="meta-btn-add">‚ûï</button>
                </div>
            </div>
            <% }) %>
    </div>

    <div class="new-meta-button">
        <a class="btn-primary">Nueva Meta</a>
    </div>
    <!-- Modal: Nueva Meta -->
    <div id="newMetaModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Crear Nueva Meta</h3>

            <form id="newMetaForm">
                <div class="modal-field">
                    <label for="metaDescripcion">Descripci√≥n de la meta</label>
                    <input type="text" id="metaDescripcion" placeholder="Ej: Viaje a Cartagena" required>
                </div>

                <div class="modal-field">
                    <label for="metaMontoObjetivo">Monto objetivo</label>
                    <input type="number" id="metaMontoObjetivo" placeholder="Ej: 2000000" required>
                </div>

                <div class="modal-field">
                    <label for="metaAporteInicial">Aporte inicial</label>
                    <input type="number" id="metaAporteInicial" placeholder="Ej: 300000" required>
                </div>

                <div class="modal-buttons">
                    <button type="button" id="cancelNewMetaBtn" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-save">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Aportar dinero -->
    <div id="addFundsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Aportar a la meta</h3>
            <form id="addFundsForm">
                <div class="modal-field">
                    <label for="addAmount">Monto a aportar</label>
                    <input type="number" id="addAmount" placeholder="Ej: 50000" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" id="cancelAddBtn" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-save">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Confirmar eliminaci√≥n -->
    <div id="deleteConfirmModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>¬øEst√°s seguro?</h3>
            <p style="text-align: center;">Esta acci√≥n eliminar√° la meta de forma permanente.</p>
            <div class="modal-buttons">
                <button type="button" id="cancelDeleteBtn" class="btn-secondary" style="background-color: #606060">Cancelar</button>
                <button type="button" id="confirmDeleteBtn" class="btn-save" style="background-color: #c70303">S√≠,
                    eliminar</button>
            </div>
        </div>
    </div>

    <script>
        // Abrir modal al hacer clic en "Nueva Meta"
        document.querySelector('.btn-primary').addEventListener('click', function (e) {
            e.preventDefault();
            document.getElementById('newMetaModal').style.display = 'flex';
        });
        // Cancelar creaci√≥n
        document.getElementById('cancelNewMetaBtn').addEventListener('click', function () {
            document.getElementById('newMetaModal').style.display = 'none';
        });
        document.getElementById('newMetaForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const descripcion = document.getElementById('metaDescripcion').value;
            const montoObj = document.getElementById('metaMontoObjetivo').value;
            const aporteIni = document.getElementById('metaAporteInicial').value;
            // alerta para ver la meta creada
            alert(`Meta creada:\n- ${descripcion}\n- Objetivo: $${montoObj}\n- Aporte inicial: $${aporteIni}`);
            document.getElementById('newMetaModal').style.display = 'none';
            this.reset();
        });
    </script>

    <script>
        let currentActionIndex = null;

        // ABRIR MODAL: Aportar dinero
        document.querySelectorAll('.meta-btn-add').forEach((button, index) => {
            button.addEventListener('click', function () {
                currentActionIndex = index;
                document.getElementById('addFundsModal').style.display = 'flex';
            });
        });

        // ABRIR MODAL: Eliminar
        document.querySelectorAll('.meta-btn-delete').forEach((button, index) => {
            button.addEventListener('click', function () {
                currentActionIndex = index;
                document.getElementById('deleteConfirmModal').style.display = 'flex';
            });
        });

        // Cerrar modales
        document.getElementById('cancelAddBtn').addEventListener('click', () => {
            document.getElementById('addFundsModal').style.display = 'none';
            currentActionIndex = null;
        });

        document.getElementById('cancelDeleteBtn').addEventListener('click', () => {
            document.getElementById('deleteConfirmModal').style.display = 'none';
            currentActionIndex = null;
        });

        // Guardar aporte
        document.getElementById('addFundsForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const monto = document.getElementById('addAmount').value;
            alert(`Se ha aportado $${monto} a la meta #${currentActionIndex + 1}`);
            document.getElementById('addFundsModal').style.display = 'none';
            this.reset();
            currentActionIndex = null;
        });

        // Confirmar eliminaci√≥n
        document.getElementById('confirmDeleteBtn').addEventListener('click', function () {
            alert(`Meta #${currentActionIndex + 1} eliminada`);
                        document.getElementById('deleteConfirmModal').style.display = 'none';
            currentActionIndex = null;
        });
    </script>
</div>