<main class="historial-container">

    <h1 class="h1">Historial</h1>

    <!-- Tabla -->
    <table class="tabla-historial">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Valor</th>
                <th>Tipo</th>
                <th>Descripci√≥n</th>
                <th class="acciones-col">Acciones</th>
            </tr>
        </thead>

        <tbody>
            <!-- FILA 1 -->
            <tr>
                <td>02/11/2025</td>
                <td class="tipo ingreso">$50000</td>
                <td class="tipo gasto">Ingreso</td>
                <td class="descripcion">Venta de zapatos</td>
                <td>
                    <button class="btn-edit">‚úè</button>
                    <button class="btn-delete">üóë</button>
                </td>
            </tr>

            <!-- FILA 2 -->
            <tr>
                <td>02/11/2025</td>
                <td class="tipo ingreso">$20000</td>
                <td class="tipo gasto">Egreso</td>
                <td class="descripcion">Taxi</td>
                <td>
                    <button class="btn-edit">‚úè</button>
                    <button class="btn-delete">üóë</button>
                </td>
            </tr>

            <!-- FILA 3 -->
            <tr>
                <td>02/11/2025</td>
                <td class="tipo ingreso">$60000</td>
                <td class="tipo gasto">Ingreso</td>
                <td class="descripcion">Venta de camisa</td>
                <td>
                    <button class="btn-edit">‚úè</button>
                    <button class="btn-delete">üóë</button>
                </td>
            </tr>

            <!-- FILA 4 -->
            <tr>
                <td>02/11/2025</td>
                <td class="tipo ingreso">$15000</td>
                <td class="tipo gasto">Egreso</td>
                <td class="descripcion">Compra de almuerzo</td>
                <td>
                    <button class="btn-edit">‚úè</button>
                    <button class="btn-delete">üóë</button>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Buscador -->
    <h2 class="titulo-buscar">Buscar por fechas</h2>

    <form class="form-busqueda">
        <div class="fechas-row">
            <div class="grupo-fecha">
                <label>Fecha inicio</label>
                <input type="date" name="fechaInicio">
            </div>

            <div class="grupo-fecha">
                <label>Fecha fin</label>
                <input type="date" name="fechaFin">
            </div>
        </div>

        <button type="submit" class="btn-buscar">Buscar</button>
        <button type="button" class="btn-descargar">Descargar</button>
    </form>

    <!-- Modal de Edici√≥n -->
    <div id="editModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Editar Transacci√≥n</h3>
            <form id="editForm">
                <div class="modal-field">
                    <label for="editValor">Valor</label>
                    <input type="number" id="editValor" required>
                </div>
                <div class="modal-field">
                    <label for="editDescripcion">Descripci√≥n</label>
                    <input type="text" id="editDescripcion" required>
                </div>
                <div class="modal-field">
                    <label for="editTipo">Tipo</label>
                    <select id="editTipo" required>
                        <option value="ingreso">Ingreso</option>
                        <option value="egreso">Egreso</option>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button type="button" id="cancelEditBtn" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-save">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n de Eliminaci√≥n -->
    <div id="deleteConfirmModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>¬øEst√°s seguro?</h3>
            <p style="text-align: center;">Esta acci√≥n eliminar√° del historial de forma permanente.</p>
            <div class="modal-buttons">
                <button type="button" id="cancelDeleteBtn" class="btn-secondary"
                    style="background-color: #606060">Cancelar</button>
                <button type="button" id="confirmDeleteBtn" class="btn-save" style="background-color: #c70303">S√≠,
                    eliminar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Descarga Exitosa -->
    <div id="downloadSuccessModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <p style="text-align: center; margin: 15px 0;">Descarga exitosa</p>
            <div class="modal-buttons">
                <button type="button" id="closeDownloadModal" class="btn-save">Aceptar</button>
            </div>
        </div>
    </div>
    <!-- Modal de Edici√≥n -->
    <div id="editModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Editar Historial</h3>

            <form id="editForm">
                <input type="hidden" id="editId">

                <div class="modal-field">
                    <label for="editValor">Valor</label>
                    <input type="number" id="editValor" required>
                </div>

                <div class="modal-field">
                    <label for="editDescripcion">Descripci√≥n</label>
                    <input type="text" id="editDescripcion" required>
                </div>

                <div class="modal-field">
                    <label for="editTipo">Tipo</label>
                    <select id="editTipo" required>
                        <option value="ingreso">Ingreso</option>
                        <option value="egreso">Egreso</option>
                    </select>
                </div>

                <div class="modal-buttons">
                    <button type="button" id="cancelEditBtn" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-save">Guardar</button>
                </div>
            </form>
        </div>
        <script>
            // Edici√≥n
            let currentEditRow = null;

            // Abrir modal al hacer clic en ‚úèÔ∏è
            document.querySelectorAll('.btn-edit').forEach((button, index) => {
                button.addEventListener('click', function () {
                    const row = this.closest('tr');
                    currentEditRow = row;

                    // Extraer datos de la fila
                    const fecha = row.cells[0].textContent.trim();
                    const valor = row.cells[1].textContent.trim().replace('$', '');
                    const tipoTexto = row.cells[2].textContent.trim();
                    const descripcion = row.cells[3].textContent.trim();

                    // Determinar tipo (ingreso/egreso)
                    const tipo = tipoTexto.toLowerCase().includes('ingreso') ? 'ingreso' : 'egreso';

                    // Rellenar el formulario
                    document.getElementById('editValor').value = valor;
                    document.getElementById('editDescripcion').value = descripcion;
                    document.getElementById('editTipo').value = tipo;
                    document.getElementById('editModal').style.display = 'flex';
                });
            });

            // Cancelar edici√≥n
            document.getElementById('cancelEditBtn').addEventListener('click', function () {
                document.getElementById('editModal').style.display = 'none';
                currentEditRow = null;
            });

            // Guardar cambios
            document.getElementById('editForm').addEventListener('submit', function (e) {
                e.preventDefault();

                if (currentEditRow) {
                    const valor = document.getElementById('editValor').value;
                    const descripcion = document.getElementById('editDescripcion').value;
                    const tipo = document.getElementById('editTipo').value;

                    // Actualizar celdas
                    currentEditRow.cells[1].textContent = '$' + valor;
                    currentEditRow.cells[2].textContent = tipo.charAt(0).toUpperCase() + tipo.slice(1);
                    currentEditRow.cells[3].textContent = descripcion;
                }
                document.getElementById('editModal').style.display = 'none';
                currentEditRow = null;
            });
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', function () {
                    currentEditRow = this.closest('tr');
                    const valor = currentEditRow.querySelector('.valor').textContent.replace('$', '');
                    const tipo = currentEditRow.querySelector('.tipo').textContent.trim().toLowerCase();
                    const desc = currentEditRow.querySelector('.descripcion').textContent;
                    document.getElementById('editValor').value = valor;
                    document.getElementById('editDescripcion').value = desc;
                    document.getElementById('editTipo').value = tipo === 'ingreso' || tipo === 'egreso' ? tipo : 'ingreso';
                    document.getElementById('editModal').style.display = 'flex';
                });
            });
            document.getElementById('cancelEditBtn').addEventListener('click', () => {
                document.getElementById('editModal').style.display = 'none';
                currentEditRow = null;
            });
            document.getElementById('editForm').addEventListener('submit', (e) => {
                e.preventDefault();
                if (currentEditRow) {
                    const v = document.getElementById('editValor').value;
                    const d = document.getElementById('editDescripcion').value;
                    const t = document.getElementById('editTipo').value;
                    currentEditRow.querySelector('.valor').textContent = '$' + v;
                    currentEditRow.querySelector('.valor').className = 'valor ' + t;
                    currentEditRow.querySelector('.tipo').textContent = t.charAt(0).toUpperCase() + t.slice(1);
                    currentEditRow.querySelector('.tipo').className = 'tipo ' + t;
                    currentEditRow.querySelector('.descripcion').textContent = d;
                }
                document.getElementById('editModal').style.display = 'none';
                currentEditRow = null;
            });
            //  Eliminaci√≥n 
            let currentDeleteRow = null;
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function () {
                    currentDeleteRow = this.closest('tr');
                    document.getElementById('deleteConfirmModal').style.display = 'flex';
                });
            });
            document.getElementById('cancelDeleteBtn').addEventListener('click', () => {
                document.getElementById('deleteConfirmModal').style.display = 'none';
                currentDeleteRow = null;
            });
            document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
                if (currentDeleteRow) currentDeleteRow.remove();
                document.getElementById('deleteConfirmModal').style.display = 'none';
                currentDeleteRow = null;
            });
            //  Descarga 
            document.querySelector('.btn-descargar').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('downloadSuccessModal').style.display = 'flex';
            });
            document.getElementById('closeDownloadModal').addEventListener('click', () => {
                document.getElementById('downloadSuccessModal').style.display = 'none';
            });
        </script>
</main>